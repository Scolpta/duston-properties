---
import logoUrl from "../assets/logo.svg?url";
const { isHome = false } = Astro.props;
---

<header
  id="site-header"
  data-home={isHome ? "true" : "false"}
  class={`w-full px-4 md:px-6 py-4 md:py-5 top-0 z-50 bg-transparent transition-shadow ${
    isHome ? "absolute" : "sticky scrolled shadow-sm"
  }`}
>
  <nav
    class="container mx-auto flex items-center justify-between relative z-10"
  >
    <a href="/" class="flex items-center gap-3 no-underline">
      <img
        src={logoUrl}
        alt="Duston Properties logo"
        class="h-6 md:h-7 w-auto"
      />
    </a>

    {/* Desktop Menu */}
    <ul
      id="desktop-nav"
      class={`hidden md:flex items-center gap-10 transition-colors ${isHome ? "text-white" : "text-primary"}`}
    >
      <li>
        <a class="hover:opacity-80 transition-colors" href="/about">About</a>
      </li>
      <li>
        <a class="hover:opacity-80 transition-colors" href="/projects"
          >Projects</a
        >
      </li>
      <li>
        <a class="hover:opacity-80 transition-colors" href="/insights"
          >Insights</a
        >
      </li>
      <li>
        <a class="hover:opacity-80 transition-colors" href="/sustainability"
          >Sustainability</a
        >
      </li>
      <li>
        <a class="hover:opacity-80 transition-colors" href="/contact">Contact</a
        >
      </li>
    </ul>

    {/* Mobile Menu Button */}
    <button
      id="mobile-menu-button"
      class={`md:hidden flex items-center justify-center p-2 transition-colors ${isHome ? "text-white" : "text-primary"}`}
      aria-label="Toggle menu"
    >
      <svg
        id="menu-icon"
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
      <svg
        id="close-icon"
        class="w-6 h-6 hidden"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </nav>

  {/* Mobile Menu */}
  <div
    id="mobile-menu"
    class="hidden md:hidden fixed inset-0 top-[72px] bg-white z-40"
  >
    <ul class="flex flex-col items-start gap-6 p-6 text-slate-700">
      <li>
        <a class="hover:text-slate-900 transition-colors text-lg" href="/about"
          >About</a
        >
      </li>
      <li>
        <a
          class="hover:text-slate-900 transition-colors text-lg"
          href="/projects">Projects</a
        >
      </li>
      <li>
        <a
          class="hover:text-slate-900 transition-colors text-lg"
          href="/insights">Insights</a
        >
      </li>
      <li>
        <a
          class="hover:text-slate-900 transition-colors text-lg"
          href="/sustainability">Sustainability</a
        >
      </li>
      <li>
        <a
          class="hover:text-slate-900 transition-colors text-lg"
          href="/contact">Contact</a
        >
      </li>
    </ul>
  </div>
</header>

<script is:inline>
  const header = document.getElementById("site-header");
  const desktopNav = document.getElementById("desktop-nav");
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const onScroll = () => {
    if (!header) return;
    const isHome = header.getAttribute("data-home") === "true";
    const scrolled = isHome ? window.scrollY > 0 : true; // non-home behaves as scrolled
    header.classList.toggle("shadow-sm", scrolled);
    header.classList.toggle("scrolled", scrolled);
    header.classList.toggle("sticky", scrolled);
    header.classList.toggle("absolute", !scrolled);

    // Swap nav colors
    desktopNav?.classList.toggle("text-white", !scrolled);
    desktopNav?.classList.toggle("text-primary", scrolled);
    mobileMenuButton?.classList.toggle("text-white", !scrolled);
    mobileMenuButton?.classList.toggle("text-primary", scrolled);
  };
  onScroll();
  window.addEventListener("scroll", onScroll, { passive: true });

  // Mobile menu toggle
  const mobileMenu = document.getElementById("mobile-menu");
  const menuIcon = document.getElementById("menu-icon");
  const closeIcon = document.getElementById("close-icon");

  mobileMenuButton?.addEventListener("click", () => {
    const isOpen = !mobileMenu?.classList.contains("hidden");
    if (isOpen) {
      mobileMenu?.classList.add("hidden");
      menuIcon?.classList.remove("hidden");
      closeIcon?.classList.add("hidden");
      document.body.style.overflow = "";
    } else {
      mobileMenu?.classList.remove("hidden");
      menuIcon?.classList.add("hidden");
      closeIcon?.classList.remove("hidden");
      document.body.style.overflow = "hidden";
    }
  });

  // Close menu when clicking on a link
  const menuLinks = mobileMenu?.querySelectorAll("a");
  menuLinks?.forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu?.classList.add("hidden");
      menuIcon?.classList.remove("hidden");
      closeIcon?.classList.add("hidden");
      document.body.style.overflow = "";
    });
  });
</script>

<style>
  /* Drop-in white background layer (only visible on home when scrolled) */
  #site-header[data-home="true"]::before {
    content: "";
    position: absolute;
    inset: 0;
    background: #ffffff;
    transform: translateY(-100%);
    opacity: 0;
    transition:
      transform 300ms cubic-bezier(0.075, 0.82, 0.165, 1),
      opacity 300ms cubic-bezier(0.075, 0.82, 0.165, 1);
  }
  #site-header[data-home="true"].scrolled::before {
    transform: translateY(0);
    opacity: 1;
  }

  /* On non-home, keep a solid white background always */
  #site-header[data-home="false"] {
    background: #ffffff;
  }
</style>
